function makeMap(idname,xmlname,awidth,aheight,datafolder,markersfolder,azoom,maptype){if(GBrowserIsCompatible()){var gmarkers=[];var i=0;var m=document.getElementById(idname);m.style.width=awidth;m.style.height=aheight;var icons=[];icons[""]=new GIcon();icons[""].image="http://www.google.com/mapfiles/marker.png";icons[""].shadow="http://www.google.com/mapfiles/shadow50.png";icons[""].iconSize=new GSize(20,34);icons[""].shadowSize=new GSize(37,34);icons[""].iconAnchor=new GPoint(9,34);icons[""].infoWindowAnchor=new GPoint(9,2);icons[""].infoShadowAnchor=new GPoint(18,25);icons[""].printImage="http://www.google.com/mapfiles/markerie.gif";icons[""].mozPrintImage="http://www.google.com/mapfiles/markerff.gif";icons[""].printShadow="http://www.google.com/mapfiles/dithshadow.gif";icons[""].transparent="http://www.google.com/mapfiles/markerTransparent.png";icons[""].imageMap=[9,0,6,1,4,2,2,4,0,8,0,12,1,14,2,16,5,19,7,23,8,26,9,30,9,34,11,34,11,30,12,26,13,24,14,21,16,18,18,16,20,12,20,8,18,4,16,2,15,1,13,0];function numberedIcon(iconStr){var iconNum=iconStr.toUpperCase();if(isNaN(parseInt(iconNum,16))){iconNum="";}else if(!isNaN(parseInt(iconNum,10))&&((iconNum<0)||(iconNum>99))){iconNum="";}else if((typeof(iconNum)=="undefined")||(iconNum===null)){iconNum="";}if(!icons[iconNum]){var icon=new GIcon(icons[""]);if(("A"<=iconNum)&&(iconNum<="Z")){icon.image="http://www.google.com/mapfiles/marker"+iconNum+".png";}else{icon.image=markersfolder+"marker"+iconNum+".png";}icons[iconNum]=icon;}return icons[iconNum];}function createMarker(point,html,iconStr){var marker=new GMarker(point);if(iconStr){marker=new GMarker(point,numberedIcon(iconStr));}GEvent.addListener(marker,"click",function(){marker.openInfoWindowHtml(html);});gmarkers[i]=marker;i++;return marker;}var map=new GMap(document.getElementById(idname));map.addControl(new GSmallMapControl());map.addControl(new GMapTypeControl());map.setCenter(new GLatLng(0,0),0);map.addMapType(G_PHYSICAL_MAP);map.removeMapType(G_HYBRID_MAP);amaptype=maptype.toUpperCase();if(amaptype=="NORMAL"||amaptype=="G_NORMAL_MAP"||amaptype=="N"){map.setMapType(G_NORMAL_MAP);}else if(amaptype=="SATELLITE"||amaptype=="G_SATELLITE_MAP"||amaptype=="S"){map.setMapType(G_SATELLITE_MAP);}else if(amaptype=="HYBRID"||amaptype=="G_HYBRID_MAP"||amaptype=="H"){map.setMapType(G_HYBRID_MAP);}else if(amaptype=="PHYSICAL"||amaptype=="G_PHYSICAL_MAP"||amaptype=="P"||amaptype=="TERRAIN"||amaptype=="T"){map.setMapType(G_PHYSICAL_MAP);}else{map.setMapType(G_NORMAL_MAP);}var bounds=new GLatLngBounds();GDownloadUrl(xmlname,function(doc,responseCode){if(responseCode==200){var xmlDoc=GXml.parse(doc);var markers=xmlDoc.documentElement.getElementsByTagName("marker");for(var i=0;i<markers.length;i++){var lat=parseFloat(markers[i].getAttribute("lat"));var lng=parseFloat(markers[i].getAttribute("lng"));var point=new GLatLng(lat,lng);var html=markers[i].getAttribute("html");html=html.replace(html.match(/href='(?!(http|ftp))/ig),"href='".concat(datafolder));html=html.replace(html.match(/href="(?!(http|ftp))/ig),'href="'.concat(datafolder));html=html.replace(html.match(/src='(?!(http|ftp))/ig),"src='".concat(datafolder));html=html.replace(html.match(/src="(?!(http|ftp))/ig),'src="'.concat(datafolder));var icon=markers[i].getAttribute("icon");var marker=createMarker(point,html,icon);map.addOverlay(marker);bounds.extend(point);}var inputs=[];inputs=inputs.concat(xmlDoc.documentElement.getElementsByTagName("line"));inputs=inputs.concat(xmlDoc.documentElement.getElementsByTagName("points"));var lines="";for(i=0;i<2;i++){lines=inputs[i];for(var j=0;j<lines.length;j++){var colour=lines[j].getAttribute("colour");if(colour===null){colour=lines[j].getAttribute("color");}if(colour===null){colour="#0000ff";}var width=lines[j].getAttribute("width");if(width===null){width="4";}width=parseFloat(width);var opacity=lines[j].getAttribute("opacity");if(opacity===null){opacity="0.75";}opacity=parseFloat(opacity);var points=lines[j].getElementsByTagName("point");var pts=[];for(var k=0;k<points.length;k++){pts[k]=new GLatLng(parseFloat(points[k].getAttribute("lat")),parseFloat(points[k].getAttribute("lng")));bounds.extend(pts[k]);}map.addOverlay(new GPolyline(pts,colour,width,opacity));}}if(azoom==-1){map.setZoom(map.getBoundsZoomLevel(bounds));}else{map.setZoom(azoom);}map.setCenter(bounds.getCenter());}else if(responseCode==-1){}else{}});}}